<!DOCTYPE html>
<html lang="en">
	<head>
		<title>BSP | Log In</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="css/myStyles.css">
		<link rel="icon" href="img/logo2.ico">
		<!-- Font Theme -->
		<!-- Use Serif for Small Text and Sans Serif for Big Text -->
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link href="https://fonts.googleapis.com/css2?family=Noto+Sans&family=Noto+Serif&display=swap" rel="stylesheet">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
		<style>
			.carousel-control {   background: none !important;   filter: none !important; progid:none !important; }
			html {
			scroll-behavior: smooth;
			}
			body{
			padding-top: 50px;
			}
			html{
				visibility: hidden;
			}
		</style>
	</head>
	<body data-spy="scroll" data-target=".navbar" data-offset="50">
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>                        
					</button>
					<a class="navbar-brand" style = "font-size: 1.5em; font-weight: bold;">Book Sale Portal</a>
				</div>
				<div class="collapse navbar-collapse" id="myNavbar">
					<ul class="nav navbar-nav" style = "text-align: center;">
						<li class = "active"><a href="#featured_items">Featured Items</a></li>
						<li><a href="#create-account">Create Account</a></li>
					</ul>
					<form class="navbar-form navbar-right" onsubmit = "return false">
						<div class="form-group" style = "margin-right: 2em;">
							<label style = "color: gray; margin-right: .5em;">Email:</label>
							<input type="email" class="form-control" id="login_email" name = "login_email" required>
						</div>
						<div class="form-group" style = "margin-right: 2em;">
							<label style = "color: gray; margin-right: .5em;">Password:</label>
							<input type="password" class="form-control" id="login_password" name = "login_password" required>
						</div>
						<button type="submit" class="btn btn-success" id="login_login" name = "login_login">Log In</button>
					</form>
				</div>
			</div>
		</nav>
		<div class = "container">
			<div class = "row" id = "login_alert_div">
			</div>
			<div class = "row" id = "featured_items">
				<div class = "col-sm-12">
					<h1 class = "big-text" style = "text-align: center; font-weight: bold; margin-top: 1em; margin-bottom: 1em;">Book Sale Portal is the ultimate platform to buy and sell books. </h1>
					<h3 style = "text-align: center; margin-bottom: 1em;">Check out some items for sale:</h3>
					<div id="myCarousel" class="carousel slide" data-ride="carousel">
						<!-- Indicators -->
						<ol class="carousel-indicators" id = "carousel-indicators">
						</ol>
						<!-- Wrapper for slides -->
						<div class="carousel-inner" id = "carousel-inner">
						</div>
					</div>
				</div>
			</div>
			<div class = "row" style = "margin-top: 2.5em;" id = "create-account">
				<div class = "col-sm-12" >
					<h1 class = "big-text" style = "text-align: center; font-weight: bold;"> Book Sale Portal is your one-stop-shop online book market. </h1>
					<h3 style = "text-align: center;">&nbsp;</h3>
					<div class = "row" id = "register_alert_div">
					</div>
					<div class="panel panel-default">
						<div class="panel-heading"><span style = "color: gray; font-weight: bold; font-size: 1.5em;">Create Account</span></div>
						<div class="panel-body">
							<ul class="nav nav-tabs">
								<li class="active"><a data-toggle="tab" href="#home">Buyer</a></li>
								<li><a data-toggle="tab" href="#menu1">Seller</a></li>
							</ul>
							<div class="tab-content">
								<div id="home" class="tab-pane fade in active">
									<form class="form-horizontal" onsubmit = "return false">
										<div class="form-group">
											<div class="col-sm-offset-2 col-sm-10">
												&nbsp;
											</div>
										</div>
										<div class = "form-group">
											<div class = "col-sm-12"><img id = "output1" src = "https://via.placeholder.com/250" class="img-responsive img-circle" style = "max-height: 250px; max-width: 250px; margin: auto;"></div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="email"><span style = "color: red;">*</span> Name:</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="buyer_name" name = "buyer_name" placeholder="Enter name" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="email"><span style = "color: red;">*</span> Email:</label>
											<div class="col-sm-10">
												<input type="email" class="form-control" id="buyer_email" name = "buyer_email" placeholder="Enter email" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="email">Contact:</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="buyer_contact_no" name = "buyer_contact_no" placeholder="Enter contact no">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="pwd"><span style = "color: red;">*</span> Password:</label>
											<div class="col-sm-10">
												<input type="password" class="form-control" id="buyer_password" name = "buyer_password" placeholder="Enter password" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="pwd"><span style = "color: red;">*</span> Confirm Password:</label>
											<div class="col-sm-10">
												<input type="password" class="form-control" id="buyer_confirm_password" name = "buyer_confirm_password" placeholder="Enter password" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="email">Image:</label>
											<div class="col-sm-10">
												<input class = "form-control" type="file" accept="image/*" id="buyer_image_location" name="buyer_image_location" onchange="loadFile2(event,1)">
											</div>
										</div>
										<div class="form-group">
											<div class="col-sm-12" style = "text-align: center;">
												<button type="submit" id="buyer_register" name = "buyer_register" class="btn btn-success">Register</button>
											</div>
										</div>
									</form>
								</div>
								<div id="menu1" class="tab-pane fade">
									<form class="form-horizontal" onsubmit = "return false">
										<div class="form-group">
											<div class="col-sm-offset-2 col-sm-10">
												&nbsp;
											</div>
										</div>
										<div class = "form-group">
											<div class = "col-sm-12"><img id = "output2" src = "https://via.placeholder.com/250" class="img-responsive img-circle" style = "max-height: 250px; max-width: 250px; margin: auto;"></div>
										</div>
										<div class = "form-group">
											<div class = "col-sm-12 text-center" style = "font-size: 1.25em; font-weight: bold;">
												<span class = "glyphicon glyphicon-alert text-primary"></span> &emsp;<a href="javascript:;" data-toggle="tooltip" title="For non-company sellers: Simply enter your personal info in the company input fields.">Please take note </a>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="email"><span style = "color: red;">*</span> Name:</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="company_name" name = "company_name" placeholder="Enter company name" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="email"><span style = "color: red;">*</span> Email:</label>
											<div class="col-sm-10">
												<input type="email" class="form-control" id="company_email" name = "company_email" placeholder="Enter company email" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="email"><span style = "color: red;">*</span> Address:</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="company_address" name = "company_address" placeholder="Enter company address" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="pwd"><span style = "color: red;">*</span> Contact:</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="company_contact_no" name = "company_contact_no" placeholder="Enter company contact no." required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="pwd"><span style = "color: red;">*</span> Contact Person:</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="company_users_name" name = "company_users_name" placeholder="Enter contact person's name" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="pwd"><span style = "color: red;">*</span> Contact Info:</label>
											<div class="col-sm-10">
												<input type="text" class="form-control" id="company_users_contact_no" name = "company_users_contact_no" placeholder="Enter contact person's contact no." required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="pwd"><span style = "color: red;">*</span> Password:</label>
											<div class="col-sm-10">
												<input type="password" class="form-control" id="company_users_password" name = "company_users_password" placeholder="Enter password" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="pwd"><span style = "color: red;">*</span> Confirm Password:</label>
											<div class="col-sm-10">
												<input type="password" class="form-control" id="company_users_confirm_password" name = "company_users_confirm_password" placeholder="Enter password" required>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-2" for="email">Image:</label>
											<div class="col-sm-10">
												<input class = "form-control" type="file" accept="image/*" id="company_image_location" name="company_image_location" onchange="loadFile2(event,2)">
											</div>
										</div>
										<div class="form-group">
											<div class="col-sm-12" style = "text-align: center;">
												<button type="submit" id="company_register" name = "company_register" class="btn btn-success">Register</button>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script>
		var loadFile = function(event) {
			var image = document.getElementById('output');
			image.src = URL.createObjectURL(event.target.files[0]);
		};
		var loadFile2 = function(event,num) {
			var image = document.getElementById('output' + num);
			image.src = URL.createObjectURL(event.target.files[0]);
		};
		$('#myCarousel').carousel({
		  interval: 4000,
		  cycle: true
		});
		function hideAlert(){
			$("#alert").fadeOut();
		}
		function hideAlert2(){
			$("#alert2").fadeOut();
		}
		
		$(document).ready(function()
		{
			var formData = new FormData();
			formData.append("PageLoad", "set");
			
			$.ajax({
				type: "POST",
				url: "Login_action_page.php",
				data: formData,             
				cache: false,
				contentType: false,
				processData: false,
				success: function(data)
				{
					var obj = JSON.parse(data);
					console.log(obj);
					if(obj["response"] == "set"){
					
						// Load Selected Random Items
							// JSON:
							// Book Title - 0
							// Image Location - 1
							// Price - 2
						
						for(i = 0, len = obj["items"].length; i < len; i++){
							
							// Carousel Element
							var is_active_str = (i == 0) ? "active" : "";
							var html_element = ' \
							<div class="item '+is_active_str+'"> \
								<img src="'+obj["items"][i][1]+'" style = "height: 700px; max-height: 700px; margin: auto;" alt="'+obj["items"][i][0]+'"> \
								<div class="carousel-caption" style = "background-color: rgba(60,60,60,0.8)"> \
									<h2 class = "big-text" style = "font-weight: bold;">'+obj["items"][i][0]+'</h2> \
									<h3>Php '+obj["items"][i][2]+'</h3> \
								</div> \
							</div> \
							';
							$("#carousel-inner").append(html_element);
							
							// Carousel Indicators
							var html_element = ' \
								<li data-target="#myCarousel" data-slide-to="'+i+'" class="'+is_active_str+'"></li> \
								';
							$("#carousel-indicators").append(html_element);
						}
						
						// Carousel Left & Right Controls
						if(obj["items"].length > 1){
							var html_element = ' \
									<a class="left carousel-control" href="#myCarousel" data-slide="prev"> \
									<span class="glyphicon glyphicon-chevron-left"></span> \
									<span class="sr-only">Previous</span> \
									</a> \
									<a class="right carousel-control" href="#myCarousel" data-slide="next"> \
									<span class="glyphicon glyphicon-chevron-right"></span> \
									<span class="sr-only">Next</span> \
									</a> \
								';
							$("#myCarousel").append(html_element);
						}
						
						// Seller tooltip
						$('[data-toggle="tooltip"]').tooltip();  
						
						$("html").css("visibility","visible");
					}
				}
			});
		});
		
		$("#buyer_register").click(function()
		{
			
			var name = $("#buyer_name").val();
			var email = $("#buyer_email").val();
			var contact_no = $("#buyer_contact_no").val();
			var password = $("#buyer_password").val();
			var c_password = $("#buyer_confirm_password").val();
			var image = $('#buyer_image_location').prop('files')[0];
			var hasImage = ($('#buyer_image_location').get(0).files.length === 0) ? "false" : "true";
			
			if(name && email && password && c_password){
			
				var formData = new FormData();
				formData.append("Buyer_Register", "set");
				formData.append("name", name);
				formData.append("email", email);
				formData.append("contact_no", contact_no);
				formData.append("password", password);
				formData.append("c_password", c_password);
				formData.append("image", image);
				formData.append("hasImage", hasImage);
				
				$.ajax({
					type: "POST",
					url: "Login_action_page.php",
					data: formData,             
					cache: false,
					contentType: false,
					processData: false,
					success: function(data)
					{
						console.log(obj);
						var obj = JSON.parse(data);
						if(obj["response"] == "set"){
							var html_element = ' \
									<div id = "alert" class="alert alert-'+obj["alert"]+' fade in"> \
											<a class="close" onClick="hideAlert();" aria-label="close">&times;</a> \
											<strong>'+obj["message"]+'</strong> \
										</div> \
								';
							$("#register_alert_div").html(html_element);
							
							// If account was created, clear form contents
							if(obj["alert"] == "success"){
								$("#buyer_name").val("");
								$("#buyer_email").val("");
								$("#buyer_contact_no").val("");
								$("#buyer_password").val("");
								$("#buyer_confirm_password").val("");
								$('#buyer_image_location').val("");
								$('#output1').prop("src","https://via.placeholder.com/250");
							}
						}
					}
				});
			}
		});
		
		$("#company_register").click(function()
		{
			
			var name = $("#company_name").val();
			var email = $("#company_email").val();
			var address = $("#company_address").val();
			var contact_no = $("#company_contact_no").val();
			var users_name = $("#company_users_name").val();
			var users_contact_no = $("#company_users_contact_no").val();
			var password = $("#company_users_password").val();
			var c_password = $("#company_users_confirm_password").val();
			var image = $('#company_image_location').prop('files')[0];
			var hasImage = ($('#company_image_location').get(0).files.length === 0) ? "false" : "true";
			
			if(name && email && address && contact_no && users_name && users_contact_no && password && c_password){
			
				var formData = new FormData();
				formData.append("Company_Register", "set");
				formData.append("name", name);
				formData.append("email", email);
				formData.append("address", address);
				formData.append("contact_no", contact_no);
				formData.append("users_name", users_name);
				formData.append("users_contact_no", users_contact_no);
				formData.append("password", password);
				formData.append("c_password", c_password);
				formData.append("image", image);
				formData.append("hasImage", hasImage);
				
				$.ajax({
					type: "POST",
					url: "Login_action_page.php",
					data: formData,             
					cache: false,
					contentType: false,
					processData: false,
					success: function(data)
					{
						console.log(obj);
						var obj = JSON.parse(data);
						if(obj["response"] == "set"){
							var html_element = ' \
									<div id = "alert" class="alert alert-'+obj["alert"]+' fade in"> \
											<a class="close" onClick="hideAlert();" aria-label="close">&times;</a> \
											<strong>'+obj["message"]+'</strong> \
										</div> \
								';
							$("#register_alert_div").html(html_element);
							
							// If account was created, clear the form content
							if(obj["alert"] == "success"){
								$("#company_name").val("");
								$("#company_email").val("");
								$("#company_address").val("");
								$("#company_contact_no").val("");
								$("#company_users_name").val("");
								$("#company_users_contact_no").val("");
								$("#company_users_password").val("");
								$("#company_users_confirm_password").val("");
								$('#company_image_location').val("");
								$('#output2').prop("src","https://via.placeholder.com/250");
							}
						}
					}
				});
			}
		});
		
		$("#login_login").click(function()
		{
			
			var email = $("#login_email").val();
			var password = $("#login_password").val();
			
			if(email && password){
			
				var formData = new FormData();
				formData.append("Login", "set");
				formData.append("email", email);
				formData.append("password", password);
				
				$.ajax({
					type: "POST",
					url: "Login_action_page.php",
					data: formData,             
					cache: false,
					contentType: false,
					processData: false,
					success: function(data)
					{
						var obj = JSON.parse(data);
						console.log(obj);
						if(obj["response"] == "login failed"){
							var html_element = ' \
									<div id = "alert2" class="alert alert-'+obj["alert"]+' fade in"> \
											<a class="close" onClick="hideAlert2();" aria-label="close">&times;</a> \
											<strong>'+obj["message"]+'</strong> \
										</div> \
								';
							$("#login_alert_div").html(html_element);
							$("#login_alert_div").css("padding-top","50px");
						}
						else if(obj["response"] == "login success"){
							if(obj["user"]["user_type"] == "seller"){
								sessionStorage.clear();
								sessionStorage.setItem("company", JSON.stringify(obj["company"]));
								sessionStorage.setItem("user", JSON.stringify(obj["user"]));
								window.location.replace("Seller/MyProfile.html");
							}
							else if(obj["user"]["user_type"] == "buyer"){
								sessionStorage.clear();
								sessionStorage.setItem("user", JSON.stringify(obj["user"]));
								window.location.replace("Buyer/MyProfile.html");
							}
							else if(obj["user"]["user_type"] == "admin"){
								sessionStorage.clear();
								sessionStorage.setItem("user", JSON.stringify(obj["user"]));
								window.location.replace("Admin/MyProfile.html");
							}
						}
					}
				});
			}
		});
	</script>
</html>